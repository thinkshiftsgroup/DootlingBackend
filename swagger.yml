openapi: 3.0.3
info:
  title: Dootling API
  description: Complete JWT authentication system with user profile management, store management, and KYC verification
  version: 1.0.0
  contact:
    name: Dootling Support
    email: support@dootling.com

servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://api.dootling.com
    description: Production server

security:
  - bearerAuth: []

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the service is running
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string

  # ==================== AUTHENTICATION ENDPOINTS ====================

  /api/auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Register a new user with email and password
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - firstname
                - lastname
                - password
              properties:
                email:
                  type: string
                  format: email
                firstname:
                  type: string
                lastname:
                  type: string
                password:
                  type: string
                  minLength: 8
                phone:
                  type: string
                howDidYouFindUs:
                  type: string
                subscribeToMarketing:
                  type: boolean
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  userId:
                    type: integer
        '400':
          description: Bad request
        '500':
          description: Internal server error

  /api/auth/verify-email:
    post:
      tags:
        - Authentication
      summary: Verify email with OTP
      description: Verify email address with OTP code sent to email
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
              properties:
                email:
                  type: string
                  format: email
                code:
                  type: string
      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
                  user:
                    type: object
        '400':
          description: Bad request
        '404':
          description: User not found

  /api/auth/resend-verification:
    post:
      tags:
        - Authentication
      summary: Resend verification code
      description: Resend OTP verification code to email
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Verification code resent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Login with email and password
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
                  user:
                    type: object
        '400':
          description: Bad request

  /api/auth/refresh-token:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get a new access token using refresh token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string

  /api/auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset
      description: Request password reset code via email
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Reset code sent to email
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/auth/verify-reset-code:
    post:
      tags:
        - Authentication
      summary: Verify password reset code
      description: Verify the password reset OTP code
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
              properties:
                email:
                  type: string
                  format: email
                code:
                  type: string
      responses:
        '200':
          description: Reset code verified
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  email:
                    type: string

  /api/auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password
      description: Reset password with verified OTP code
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
                - newPassword
              properties:
                email:
                  type: string
                  format: email
                code:
                  type: string
                newPassword:
                  type: string
                  minLength: 8
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/auth/set-password:
    post:
      tags:
        - Authentication
      summary: Set password for authenticated user
      description: Change password for authenticated user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  minLength: 8
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Logout and invalidate refresh token
      responses:
        '200':
          description: Logged out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  # ==================== USER PROFILE ENDPOINTS ====================

  /api/user/profile:
    get:
      tags:
        - User Profile
      summary: Get user profile
      description: Retrieve the authenticated user's complete profile including personal and identification details
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                      username:
                        type: string
                      fullName:
                        type: string
                      firstname:
                        type: string
                      lastname:
                        type: string
                      middleName:
                        type: string
                      gender:
                        type: string
                      dateOfBirth:
                        type: string
                        format: date
                      phone:
                        type: string
                      meansOfIdentification:
                        type: string
                      identificationNumber:
                        type: string
                      identificationExpiry:
                        type: string
                        format: date
                      countryOfResidency:
                        type: string
                      contactAddress:
                        type: string
                      profilePhotoUrl:
                        type: string
                      isVerified:
                        type: boolean
        '401':
          description: Unauthorized

    put:
      tags:
        - User Profile
      summary: Update user profile
      description: Update user profile including personal and identification details
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstname:
                  type: string
                lastname:
                  type: string
                middleName:
                  type: string
                gender:
                  type: string
                  enum: [Male, Female, Other]
                dateOfBirth:
                  type: string
                  format: date
                phone:
                  type: string
                meansOfIdentification:
                  type: string
                  enum: [NIN, VOTERS_CARD, DRIVERS_LICENSE, INTERNATIONAL_PASSPORT]
                identificationNumber:
                  type: string
                identificationExpiry:
                  type: string
                  format: date
                countryOfResidency:
                  type: string
                contactAddress:
                  type: string
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    type: object
        '400':
          description: Bad request
        '401':
          description: Unauthorized

  /api/user/profile/photo:
    post:
      tags:
        - User Profile
      summary: Upload profile photo
      description: Upload profile photo to Cloudinary
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Photo uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  profilePhotoUrl:
                    type: string
        '400':
          description: No file provided
        '401':
          description: Unauthorized

  # ==================== KYC PERSONAL ENDPOINTS ====================

  /api/kyc/personal:
    get:
      tags:
        - KYC Personal
      summary: Get personal KYC profile
      description: Retrieve personal KYC information
      responses:
        '200':
          description: Personal KYC retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    type: object
        '401':
          description: Unauthorized

    put:
      tags:
        - KYC Personal
      summary: Update personal KYC profile
      description: Create or update personal KYC information
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                middleName:
                  type: string
                gender:
                  type: string
                dateOfBirth:
                  type: string
                  format: date
                meansOfIdentification:
                  type: string
                identificationNumber:
                  type: string
                identificationExpiry:
                  type: string
                  format: date
                countryOfResidency:
                  type: string
                contactAddress:
                  type: string
      responses:
        '200':
          description: Personal KYC updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  profile:
                    type: object
        '401':
          description: Unauthorized

  # ==================== KYC BUSINESS ENDPOINTS ====================

  /api/kyc/business:
    get:
      tags:
        - KYC Business
      summary: Get business KYC profile
      description: Retrieve business KYC information
      responses:
        '200':
          description: Business KYC retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    type: object
        '401':
          description: Unauthorized

    put:
      tags:
        - KYC Business
      summary: Update business KYC profile
      description: Create or update business KYC information
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - businessName
              properties:
                businessName:
                  type: string
                companyType:
                  type: string
                incorporationNumber:
                  type: string
                dateOfIncorporation:
                  type: string
                  format: date
                countryOfIncorporation:
                  type: string
                taxNumber:
                  type: string
                companyAddress:
                  type: string
                zipOrPostcode:
                  type: string
                stateOrProvince:
                  type: string
                city:
                  type: string
                businessDescription:
                  type: string
                companyWebsite:
                  type: string
      responses:
        '200':
          description: Business KYC updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  profile:
                    type: object
        '400':
          description: Bad request
        '401':
          description: Unauthorized

  # ==================== KYC DOCUMENTS ENDPOINTS ====================

  /api/kyc/documents:
    get:
      tags:
        - KYC Documents
      summary: Get KYC documents
      description: List all uploaded KYC documents
      responses:
        '200':
          description: Documents retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  documents:
                    type: array
                    items:
                      type: object
        '401':
          description: Unauthorized

    put:
      tags:
        - KYC Documents
      summary: Save KYC documents
      description: Save KYC document URLs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - documents
              properties:
                documents:
                  type: array
                  items:
                    type: object
                    required:
                      - type
                      - url
                    properties:
                      type:
                        type: string
                        enum:
                          - GOVERNMENT_ID
                          - INCORPORATION_CERTIFICATE
                          - ARTICLE_OF_ASSOCIATION
                          - PROOF_OF_ADDRESS
                          - SELFIE_WITH_ID
                          - BANK_STATEMENT
                          - ADDITIONAL
                      url:
                        type: string
      responses:
        '200':
          description: Documents saved
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  count:
                    type: integer
        '400':
          description: Bad request
        '401':
          description: Unauthorized

  /api/kyc/documents/upload:
    post:
      tags:
        - KYC Documents
      summary: Upload KYC documents
      description: Upload KYC documents to Cloudinary
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                governmentId:
                  type: string
                  format: binary
                incorporationCertificate:
                  type: string
                  format: binary
                articleOfAssociation:
                  type: string
                  format: binary
                proofOfAddress:
                  type: string
                  format: binary
                selfieWithId:
                  type: string
                  format: binary
                bankStatement:
                  type: string
                  format: binary
                additionalDocuments:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        '200':
          description: Documents uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  documents:
                    type: array
                    items:
                      type: object
        '400':
          description: No files provided
        '401':
          description: Unauthorized

  # ==================== KYC PEPS ENDPOINTS ====================

  /api/kyc/peps:
    get:
      tags:
        - KYC PEPS
      summary: Get PEPs
      description: List all Politically Exposed Persons
      responses:
        '200':
          description: PEPs retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  peps:
                    type: array
                    items:
                      type: object
        '401':
          description: Unauthorized

    put:
      tags:
        - KYC PEPS
      summary: Save PEPs
      description: Save Politically Exposed Persons information
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - peps
              properties:
                peps:
                  type: array
                  items:
                    type: object
                    required:
                      - name
                      - position
                    properties:
                      name:
                        type: string
                      position:
                        type: string
                      description:
                        type: string
      responses:
        '200':
          description: PEPs saved
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  count:
                    type: integer
        '401':
          description: Unauthorized

  # ==================== KYC SUBMISSION ENDPOINTS ====================

  /api/kyc/submit:
    post:
      tags:
        - KYC Submission
      summary: Submit KYC for approval
      description: Submit complete KYC for review and approval
      responses:
        '200':
          description: KYC submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  profile:
                    type: object
        '400':
          description: Bad request
        '401':
          description: Unauthorized

  # ==================== STORE ENDPOINTS ====================

  /api/store/setup:
    post:
      tags:
        - Store
      summary: Setup store
      description: Create a new store for the authenticated user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - businessName
                - storeUrl
                - country
              properties:
                businessName:
                  type: string
                storeUrl:
                  type: string
                country:
                  type: string
                currency:
                  type: string
                  default: USD
      responses:
        '201':
          description: Store created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  store:
                    type: object
        '400':
          description: Bad request
        '401':
          description: Unauthorized

  /api/store:
    get:
      tags:
        - Store
      summary: Get store
      description: Retrieve the authenticated user's store details
      responses:
        '200':
          description: Store retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  store:
                    type: object
        '401':
          description: Unauthorized
        '404':
          description: Store not found

    put:
      tags:
        - Store
      summary: Update store
      description: Update the authenticated user's store details
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                businessName:
                  type: string
                country:
                  type: string
                currency:
                  type: string
      responses:
        '200':
          description: Store updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  store:
                    type: object
        '400':
          description: Bad request
        '401':
          description: Unauthorized

  /api/store/launch:
    post:
      tags:
        - Store
      summary: Launch store
      description: Launch the authenticated user's store
      responses:
        '200':
          description: Store launched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  store:
                    type: object
        '400':
          description: Bad request
        '401':
          description: Unauthorized

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT authentication token

  schemas:
    Error:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        stack:
          type: object
