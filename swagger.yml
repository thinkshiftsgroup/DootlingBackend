openapi: 3.0.3
info:
  title: Dootling API
  description: Complete JWT authentication system with user profile management, store management, and KYC verification
  version: 1.0.0
  contact:
    name: Dootling Support
    email: support@dootling.com

servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://api.dootling.com
    description: Production server

security:
  - bearerAuth: []

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the service is running
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string

  # ==================== AUTHENTICATION ENDPOINTS ====================

  /api/auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Register a new user with email and password. Sends verification code to email.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - firstname
                - lastname
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                firstname:
                  type: string
                  example: John
                lastname:
                  type: string
                  example: Doe
                password:
                  type: string
                  minLength: 8
                  example: password123
                phone:
                  type: string
                  example: "+1234567890"
                howDidYouFindUs:
                  type: string
                  example: Google
                subscribeToMarketing:
                  type: boolean
                  example: true
      responses:
        '201':
          description: User registered successfully. Verification code sent to email.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Registration successful. Please check your email for verification code."
                  userId:
                    type: integer
                    example: 1
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/verify-email:
    post:
      tags:
        - Authentication
      summary: Verify email with OTP
      description: Verify email address with OTP code sent to email. Returns access and refresh tokens.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: Email verified successfully. User is now authenticated.
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  refreshToken:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                      fullName:
                        type: string
                      isVerified:
                        type: boolean
        '400':
          description: Bad request - invalid code or code expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/resend-verification:
    post:
      tags:
        - Authentication
      summary: Resend verification code
      description: Resend OTP verification code to email
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Verification code resent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Login with email and password. Email must be verified first.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  example: password123
      responses:
        '200':
          description: Login successful. Returns access and refresh tokens.
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  refreshToken:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                      fullName:
                        type: string
                      username:
                        type: string
        '400':
          description: Bad request - invalid credentials or email not verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/refresh-token:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get a new access token using refresh token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '400':
          description: Bad request - invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset
      description: Request password reset code via email
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: Reset code sent to email
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password reset code sent to your email"
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/verify-reset-code:
    post:
      tags:
        - Authentication
      summary: Verify password reset code
      description: Verify the password reset OTP code
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: Reset code verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Reset code verified"
                  email:
                    type: string
                    example: user@example.com
        '400':
          description: Bad request - invalid or expired code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password
      description: Reset password with verified OTP code
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
                - newPassword
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                code:
                  type: string
                  example: "123456"
                newPassword:
                  type: string
                  minLength: 8
                  example: newpassword123
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password reset successful"
        '400':
          description: Bad request - invalid code or password too short
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/set-password:
    post:
      tags:
        - Authentication
      summary: Set password for authenticated user
      description: Change password for authenticated user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  minLength: 8
                  example: newpassword123
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password changed successfully"
        '400':
          description: Bad request - password too short
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Logout and invalidate refresh token
      responses:
        '200':
          description: Logged out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logged out successfully"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== USER PROFILE ENDPOINTS ====================

  /api/user/profile:
    get:
      tags:
        - User Profile
      summary: Get user profile
      description: Retrieve the authenticated user's complete profile including personal and identification details
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      email:
                        type: string
                        example: user@example.com
                      username:
                        type: string
                        example: johndoe1234
                      fullName:
                        type: string
                        example: John Michael Doe
                      firstname:
                        type: string
                        example: John
                      lastname:
                        type: string
                        example: Doe
                      middleName:
                        type: string
                        example: Michael
                      gender:
                        type: string
                        example: Male
                      dateOfBirth:
                        type: string
                        format: date
                        example: "1990-01-15"
                      phone:
                        type: string
                        example: "+1234567890"
                      meansOfIdentification:
                        type: string
                        example: INTERNATIONAL_PASSPORT
                      identificationNumber:
                        type: string
                        example: A12345678
                      identificationExpiry:
                        type: string
                        format: date
                        example: "2030-12-31"
                      countryOfResidency:
                        type: string
                        example: United States
                      contactAddress:
                        type: string
                        example: "123 Main Street, New York, NY 10001"
                      profilePhotoUrl:
                        type: string
                        example: "https://res.cloudinary.com/..."
                      isVerified:
                        type: boolean
                        example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - User Profile
      summary: Update user profile
      description: Update user profile including personal and identification details. All fields are optional.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstname:
                  type: string
                  example: John
                lastname:
                  type: string
                  example: Doe
                middleName:
                  type: string
                  example: Michael
                gender:
                  type: string
                  enum: [Male, Female, Other]
                  example: Male
                dateOfBirth:
                  type: string
                  format: date
                  example: "1990-01-15"
                phone:
                  type: string
                  example: "+1234567890"
                meansOfIdentification:
                  type: string
                  enum: [NIN, VOTERS_CARD, DRIVERS_LICENSE, INTERNATIONAL_PASSPORT]
                  example: INTERNATIONAL_PASSPORT
                identificationNumber:
                  type: string
                  example: A12345678
                identificationExpiry:
                  type: string
                  format: date
                  example: "2030-12-31"
                countryOfResidency:
                  type: string
                  example: United States
                contactAddress:
                  type: string
                  example: "123 Main Street, New York, NY 10001"
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Profile updated successfully"
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                      firstname:
                        type: string
                      lastname:
                        type: string
                      middleName:
                        type: string
                      gender:
                        type: string
                      dateOfBirth:
                        type: string
                        format: date
                      phone:
                        type: string
                      meansOfIdentification:
                        type: string
                      identificationNumber:
                        type: string
                      identificationExpiry:
                        type: string
                        format: date
                      countryOfResidency:
                        type: string
                      contactAddress:
                        type: string
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/user/profile/photo:
    post:
      tags:
        - User Profile
      summary: Upload profile photo
      description: Upload profile photo to Cloudinary. Supported formats - JPEG, PNG, PDF. Max size 50MB.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Profile photo file (JPEG, PNG, or PDF)
      responses:
        '200':
          description: Photo uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Profile photo uploaded successfully"
                  profilePhotoUrl:
                    type: string
                    example: "https://res.cloudinary.com/..."
        '400':
          description: No file provided or invalid file type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== KYC PERSONAL ENDPOINTS ====================

  /api/kyc/personal:
    get:
      tags:
        - KYC Personal
      summary: Get personal KYC profile
      description: Retrieve personal KYC information for the authenticated user
      responses:
        '200':
          description: Personal KYC retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    type: object
                    properties:
                      id:
                        type: integer
                      userId:
                        type: integer
                      middleName:
                        type: string
                      gender:
                        type: string
                      dateOfBirth:
                        type: string
                        format: date
                      meansOfIdentification:
                        type: string
                      identificationNumber:
                        type: string
                      identificationExpiry:
                        type: string
                        format: date
                      countryOfResidency:
                        type: string
                      contactAddress:
                        type: string
                      status:
                        type: string
                        enum: [NOT_STARTED, IN_PROGRESS, SUBMITTED, APPROVED, REJECTED]
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - KYC Personal
      summary: Update personal KYC profile
      description: Create or update personal KYC information. All fields are optional.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                middleName:
                  type: string
                  example: Michael
                gender:
                  type: string
                  example: Male
                dateOfBirth:
                  type: string
                  format: date
                  example: "1990-01-15"
                meansOfIdentification:
                  type: string
                  example: INTERNATIONAL_PASSPORT
                identificationNumber:
                  type: string
                  example: A12345678
                identificationExpiry:
                  type: string
                  format: date
                  example: "2030-12-31"
                countryOfResidency:
                  type: string
                  example: United States
                contactAddress:
                  type: string
                  example: "123 Main Street, New York, NY 10001"
      responses:
        '200':
          description: Personal KYC updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Personal KYC profile created"
                  profile:
                    type: object
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== KYC BUSINESS ENDPOINTS ====================

  /api/kyc/business:
    get:
      tags:
        - KYC Business
      summary: Get business KYC profile
      description: Retrieve business KYC information for the authenticated user
      responses:
        '200':
          description: Business KYC retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    type: object
                    properties:
                      id:
                        type: integer
                      userId:
                        type: integer
                      businessName:
                        type: string
                      companyType:
                        type: string
                      incorporationNumber:
                        type: string
                      dateOfIncorporation:
                        type: string
                        format: date
                      countryOfIncorporation:
                        type: string
                      taxNumber:
                        type: string
                      companyAddress:
                        type: string
                      zipOrPostcode:
                        type: string
                      stateOrProvince:
                        type: string
                      city:
                        type: string
                      businessDescription:
                        type: string
                      companyWebsite:
                        type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - KYC Business
      summary: Update business KYC profile
      description: Create or update business KYC information. Business name is required.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - businessName
              properties:
                businessName:
                  type: string
                  example: "Test Business Ltd"
                companyType:
                  type: string
                  example: "Limited Liability Company"
                incorporationNumber:
                  type: string
                  example: "RC123456"
                dateOfIncorporation:
                  type: string
                  format: date
                  example: "2020-01-01"
                countryOfIncorporation:
                  type: string
                  example: "Nigeria"
                taxNumber:
                  type: string
                  example: "TAX123456"
                companyAddress:
                  type: string
                  example: "456 Business Ave"
                zipOrPostcode:
                  type: string
                  example: "100001"
                stateOrProvince:
                  type: string
                  example: "Lagos"
                city:
                  type: string
                  example: "Lagos"
                businessDescription:
                  type: string
                  example: "E-commerce platform"
                companyWebsite:
                  type: string
                  example: "https://testbusiness.com"
      responses:
        '200':
          description: Business KYC updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Business KYC created"
                  profile:
                    type: object
        '400':
          description: Bad request - business name required or empty
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== KYC DOCUMENTS ENDPOINTS ====================

  /api/kyc/documents:
    get:
      tags:
        - KYC Documents
      summary: Get KYC documents
      description: List all uploaded KYC documents for the authenticated user
      responses:
        '200':
          description: Documents retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  documents:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        userId:
                          type: integer
                        type:
                          type: string
                          enum:
                            - GOVERNMENT_ID
                            - INCORPORATION_CERTIFICATE
                            - ARTICLE_OF_ASSOCIATION
                            - PROOF_OF_ADDRESS
                            - SELFIE_WITH_ID
                            - BANK_STATEMENT
                            - ADDITIONAL
                        url:
                          type: string
                        uploadedAt:
                          type: string
                          format: date-time
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - KYC Documents
      summary: Save KYC documents
      description: Save KYC document URLs. At least one document is required.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - documents
              properties:
                documents:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - type
                      - url
                    properties:
                      type:
                        type: string
                        enum:
                          - GOVERNMENT_ID
                          - INCORPORATION_CERTIFICATE
                          - ARTICLE_OF_ASSOCIATION
                          - PROOF_OF_ADDRESS
                          - SELFIE_WITH_ID
                          - BANK_STATEMENT
                          - ADDITIONAL
                        example: GOVERNMENT_ID
                      url:
                        type: string
                        example: "https://res.cloudinary.com/..."
      responses:
        '200':
          description: Documents saved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "KYC documents saved"
                  count:
                    type: integer
                    example: 2
        '400':
          description: Bad request - no documents provided
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/kyc/documents/upload:
    post:
      tags:
        - KYC Documents
      summary: Upload KYC documents
      description: Upload KYC documents to Cloudinary. Supported formats - JPEG, PNG, PDF. Max size 50MB per file, max 5 files.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                governmentId:
                  type: string
                  format: binary
                  description: Government issued ID
                incorporationCertificate:
                  type: string
                  format: binary
                  description: Business incorporation certificate
                articleOfAssociation:
                  type: string
                  format: binary
                  description: Article of association
                proofOfAddress:
                  type: string
                  format: binary
                  description: Proof of address
                selfieWithId:
                  type: string
                  format: binary
                  description: Selfie with ID
                bankStatement:
                  type: string
                  format: binary
                  description: Bank statement
                additionalDocuments:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Additional documents (max 5)
      responses:
        '200':
          description: Documents uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Files uploaded successfully"
                  documents:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                        url:
                          type: string
        '400':
          description: No files provided or invalid file type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== KYC PEPS ENDPOINTS ====================

  /api/kyc/peps:
    get:
      tags:
        - KYC PEPS
      summary: Get PEPs
      description: List all Politically Exposed Persons for the authenticated user
      responses:
        '200':
          description: PEPs retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  peps:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        userId:
                          type: integer
                        name:
                          type: string
                        position:
                          type: string
                        description:
                          type: string
                        createdAt:
                          type: string
                          format: date-time
                        updatedAt:
                          type: string
                          format: date-time
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - KYC PEPS
      summary: Save PEPs
      description: Save Politically Exposed Persons information
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - peps
              properties:
                peps:
                  type: array
                  items:
                    type: object
                    required:
                      - name
                      - position
                    properties:
                      name:
                        type: string
                        example: "Jane Doe"
                      position:
                        type: string
                        example: "Minister of Finance"
                      description:
                        type: string
                        example: "Senior government official"
      responses:
        '200':
          description: PEPs saved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "PEPs saved"
                  count:
                    type: integer
                    example: 1
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== KYC SUBMISSION ENDPOINTS ====================

  /api/kyc/submit:
    post:
      tags:
        - KYC Submission
      summary: Submit KYC for approval
      description: Submit complete KYC for review and approval. Personal KYC must be complete.
      responses:
        '200':
          description: KYC submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "KYC submitted for approval"
                  profile:
                    type: object
                    properties:
                      id:
                        type: integer
                      userId:
                        type: integer
                      status:
                        type: string
                        enum: [NOT_STARTED, IN_PROGRESS, SUBMITTED, APPROVED, REJECTED]
                        example: SUBMITTED
        '400':
          description: Bad request - incomplete KYC information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: KYC profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== STORE ENDPOINTS ====================

  /api/store/setup:
    post:
      tags:
        - Store
      summary: Setup store
      description: Create a new store for the authenticated user. Each user can have only one store.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - businessName
                - storeUrl
                - country
              properties:
                businessName:
                  type: string
                  example: "My Awesome Shop"
                storeUrl:
                  type: string
                  example: "my-awesome-shop"
                  description: "3-63 characters, lowercase alphanumeric and hyphens only"
                country:
                  type: string
                  example: "United States"
                currency:
                  type: string
                  default: USD
                  example: USD
      responses:
        '201':
          description: Store created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Store setup successful"
                  store:
                    type: object
                    properties:
                      id:
                        type: integer
                      businessName:
                        type: string
                      storeUrl:
                        type: string
                      country:
                        type: string
                      currency:
                        type: string
                      isLaunched:
                        type: boolean
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/store:
    get:
      tags:
        - Store
      summary: Get store
      description: Retrieve the authenticated user's store details
      responses:
        '200':
          description: Store retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  store:
                    type: object
                    properties:
                      id:
                        type: integer
                      businessName:
                        type: string
                      storeUrl:
                        type: string
                      country:
                        type: string
                      currency:
                        type: string
                      isLaunched:
                        type: boolean
                      createdAt:
                        type: string
                        format: date-time
                      updatedAt:
                        type: string
                        format: date-time
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Store not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Store
      summary: Update store
      description: Update the authenticated user's store details. Store URL cannot be changed.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                businessName:
                  type: string
                  example: "Updated Shop Name"
                country:
                  type: string
                  example: "Canada"
                currency:
                  type: string
                  example: "CAD"
      responses:
        '200':
          description: Store updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Store updated successfully"
                  store:
                    type: object
                    properties:
                      id:
                        type: integer
                      businessName:
                        type: string
                      storeUrl:
                        type: string
                      country:
                        type: string
                      currency:
                        type: string
                      isLaunched:
                        type: boolean
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Store not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/store/launch:
    post:
      tags:
        - Store
      summary: Launch store
      description: Launch the authenticated user's store. Once launched, the store becomes publicly accessible.
      responses:
        '200':
          description: Store launched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Store launched successfully"
                  store:
                    type: object
                    properties:
                      id:
                        type: integer
                      businessName:
                        type: string
                      storeUrl:
                        type: string
                      country:
                        type: string
                      currency:
                        type: string
                      isLaunched:
                        type: boolean
                        example: true
        '400':
          description: Bad request - store already launched
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Store not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== CATEGORY ENDPOINTS ====================

  /api/categories:
    get:
      tags:
        - Categories
      summary: Get all categories
      description: Retrieve all product categories for the authenticated user's store
      responses:
        '200':
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  categories:
                    type: array
                    items:
                      $ref: '#/components/schemas/Category'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Categories
      summary: Create a new category
      description: Create a new product category for the authenticated user's store
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: "Electronics"
                description:
                  type: string
                  example: "Electronic devices and accessories"
                image:
                  type: string
                  example: "https://example.com/category-image.jpg"
      responses:
        '201':
          description: Category created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Category created successfully"
                  category:
                    $ref: '#/components/schemas/Category'
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/categories/{categoryId}:
    get:
      tags:
        - Categories
      summary: Get category by ID
      description: Retrieve a specific category by ID
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Category retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  category:
                    $ref: '#/components/schemas/Category'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Categories
      summary: Update category
      description: Update a category by ID
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Updated Electronics"
                description:
                  type: string
                  example: "Updated description"
                image:
                  type: string
                  example: "https://example.com/updated-image.jpg"
      responses:
        '200':
          description: Category updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Category updated successfully"
                  category:
                    $ref: '#/components/schemas/Category'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Categories
      summary: Delete category
      description: Delete a category by ID
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Category deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Category deleted successfully"
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== PRODUCT ENDPOINTS ====================

  /api/products:
    get:
      tags:
        - Products
      summary: Get all products
      description: Retrieve all products for the authenticated user's store
      parameters:
        - name: categoryId
          in: query
          required: false
          schema:
            type: integer
          description: Filter products by category ID
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
          description: Page number for pagination
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 10
          description: Number of products per page
      responses:
        '200':
          description: Products retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  products:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                      limit:
                        type: integer
                      total:
                        type: integer
                      totalPages:
                        type: integer
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Products
      summary: Create a new product
      description: Create a new product for the authenticated user's store
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - price
                - categoryId
              properties:
                name:
                  type: string
                  example: "Wireless Headphones"
                description:
                  type: string
                  example: "High-quality wireless headphones with noise cancellation"
                price:
                  type: number
                  format: float
                  example: 99.99
                compareAtPrice:
                  type: number
                  format: float
                  example: 149.99
                sku:
                  type: string
                  example: "WH-001"
                barcode:
                  type: string
                  example: "1234567890123"
                weight:
                  type: number
                  format: float
                  example: 0.5
                categoryId:
                  type: integer
                  example: 1
                images:
                  type: array
                  items:
                    type: string
                  example: ["https://example.com/product1.jpg", "https://example.com/product2.jpg"]
                tags:
                  type: array
                  items:
                    type: string
                  example: ["wireless", "bluetooth", "audio"]
                status:
                  type: string
                  enum: [ACTIVE, INACTIVE, DRAFT]
                  example: "ACTIVE"
                inventory:
                  type: object
                  properties:
                    quantity:
                      type: integer
                      example: 100
                    trackQuantity:
                      type: boolean
                      example: true
                    allowOutOfStock:
                      type: boolean
                      example: false
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Product created successfully"
                  product:
                    $ref: '#/components/schemas/Product'
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/products/{productId}:
    get:
      tags:
        - Products
      summary: Get product by ID
      description: Retrieve a specific product by ID
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Product retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  product:
                    $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Products
      summary: Update product
      description: Update a product by ID
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Updated Wireless Headphones"
                description:
                  type: string
                  example: "Updated description"
                price:
                  type: number
                  format: float
                  example: 89.99
                compareAtPrice:
                  type: number
                  format: float
                  example: 139.99
                sku:
                  type: string
                  example: "WH-001-UPD"
                barcode:
                  type: string
                  example: "1234567890124"
                weight:
                  type: number
                  format: float
                  example: 0.6
                categoryId:
                  type: integer
                  example: 2
                images:
                  type: array
                  items:
                    type: string
                  example: ["https://example.com/updated-product1.jpg"]
                tags:
                  type: array
                  items:
                    type: string
                  example: ["wireless", "bluetooth", "audio", "updated"]
                status:
                  type: string
                  enum: [ACTIVE, INACTIVE, DRAFT]
                  example: "ACTIVE"
                inventory:
                  type: object
                  properties:
                    quantity:
                      type: integer
                      example: 150
                    trackQuantity:
                      type: boolean
                      example: true
                    allowOutOfStock:
                      type: boolean
                      example: false
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Product updated successfully"
                  product:
                    $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Products
      summary: Delete product
      description: Delete a product by ID
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Product deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Product deleted successfully"
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT authentication token

  schemas:
    Error:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        stack:
          type: object

    Category:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Electronics"
        description:
          type: string
          example: "Electronic devices and accessories"
        image:
          type: string
          example: "https://example.com/category-image.jpg"
        storeId:
          type: integer
          example: 1
        createdAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"

    Product:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Wireless Headphones"
        description:
          type: string
          example: "High-quality wireless headphones with noise cancellation"
        price:
          type: number
          format: float
          example: 99.99
        compareAtPrice:
          type: number
          format: float
          example: 149.99
        sku:
          type: string
          example: "WH-001"
        barcode:
          type: string
          example: "1234567890123"
        weight:
          type: number
          format: float
          example: 0.5
        categoryId:
          type: integer
          example: 1
        storeId:
          type: integer
          example: 1
        images:
          type: array
          items:
            type: string
          example: ["https://example.com/product1.jpg", "https://example.com/product2.jpg"]
        tags:
          type: array
          items:
            type: string
          example: ["wireless", "bluetooth", "audio"]
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DRAFT]
          example: "ACTIVE"
        inventory:
          type: object
          properties:
            quantity:
              type: integer
              example: 100
            trackQuantity:
              type: boolean
              example: true
            allowOutOfStock:
              type: boolean
              example: false
        createdAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
